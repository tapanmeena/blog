---
import BaseLayout from "@layouts/BaseLayout.astro";
import type { CollectionEntry } from "astro:content";
import { getCollection } from "astro:content";

export async function getStaticPaths() {
  const posts = await getCollection("blog");
  return posts
    .filter((post) => !post.data.draft)
    .map((post) => ({
      params: { slug: post.slug },
      props: { post },
    }));
}

type Props = {
  post: CollectionEntry<"blog">;
};

const { post } = Astro.props;
const { Content } = await post.render();

const formattedDate = post.data.publishedAt.toLocaleDateString("en-US", {
  year: "numeric",
  month: "long",
  day: "numeric",
});
---

<BaseLayout pageTitle={post.data.title}>
  <article class="article-container">
    <header class="article-header">
      <h1 class="article-title">{post.data.title}</h1>
      <p class="article-meta">
        <time datetime={post.data.publishedAt.toISOString()}>{formattedDate}</time>
      </p>
      {post.data.description && <p class="article-description">{post.data.description}</p>}
    </header>
    <div class="prose">
      <Content />
    </div>
  </article>
</BaseLayout>

<style>
  @reference "tailwindcss";

  @layer components {
    .article-container {
      @apply mx-auto max-w-3xl px-4 py-8 sm:px-6 lg:px-8;
    }

    .article-header {
      @apply mb-8 border-b border-(--color-border) pb-8;
    }

    .article-title {
      @apply text-3xl font-bold tracking-tight sm:text-4xl;
      font-family: var(--font-sans);
      color: var(--color-text);
    }

    .article-meta {
      @apply mt-3 text-sm;
      color: var(--color-muted);
    }

    .article-description {
      @apply mt-4 text-lg;
      color: var(--color-muted);
    }
  }
</style>
